<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<meta content="telephone=no" name="format-detection" />
		<meta content="email=no" name="format-detection" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<script src="js/jquery-3.2.1.js"></script>
		<script type="text/javascript" src="js/rem.js"></script>
		<link rel="stylesheet" type="text/css" href="css/box.css"/>
		<!-- <title>
			我的
		</title> -->
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
				list-style: none;
			}
			html,body{
				background: #F8F8F8;
			}
			.footer {
				width: 100%;
				height: 0.96rem;
				background: #fff;
				position: fixed;
				bottom: 0;
				left: 0;
				right: 0;
				z-index: 100;
			}

			.footer nav {
				display: -webkit-box;
				display: -ms-flexbox;
				display: flex;
				justify-content: space-around;
				line-height: 1;
				text-align: center;
				margin-top: 0.1rem;
			}
			.footer nav a{
				text-decoration: none;
			}
			.footer nav p {
				font-size: 0.22rem;
				color: #666666;
				margin-top: 0.1rem;
			}

			.footer .icon {
				width: 0.44rem;
				height: 0.44rem;
			}

			.footer .select-btn p {
				font-size: 0.22rem;
				color: #D7142A;
			}
			.fenlei {
				width: 100%;
				height: 0.96rem;
				line-height: 0.96rem;
				font-size: 0.34rem;
				color: #333333;
				text-align: center;
				border-bottom: 1px solid #EEEEEE;
				background: white;
			}
			.news{
				width: 100%;
				padding: 0.36rem 0.4rem;
				display: flex;
				align-items: center;
				box-sizing: border-box;
			}
			.news img{
				width: 0.9rem;
				height: 0.9rem;
				border-radius: 50%;
				object-fit: cover;
			}
			.news p{
				font-size: 0.32rem;
				color: #333333;
				margin-left: 0.3rem;
			}
			.zhongxin{
				width: 6.7rem;
				height: 2.44rem;
				background: white;
				margin: auto;
				overflow: hidden;
			}
			.zhong_tit{
				font-size: 0.26rem;
				color: #333333;
				margin-left: 0.35rem;
				margin-top: 0.35rem;
			}
			.zhong_ul{
				width: 100%;
				padding: 0 0.4rem;
				box-sizing: border-box;
				margin-top: 0.4rem;
				display: flex;
				justify-content: space-between;
				text-align: center;
			}
			.zhong_ul li img{
				width: 0.44rem;
				height: 0.38rem;
			}
				
			.zhong_ul li p{
				font-size: 0.24rem;
				color: #666666;
				margin-top: 0.2rem;
			}
			.wode{
				width: 6.7rem;
				height: 4.58rem;
				margin: 0.36rem auto;
				background: white;
				border-radius: 0.1rem;
			}
			.wode li{
				width: 90%;
				margin: auto;
				height: 0.9rem;
				line-height: 0.9rem;
				border-bottom: 1px solid #EEEEEE;
				color: #333333;
				font-size: 0.26rem;
			}
			.wode li:last-child{
				border: none;
			}
		</style>
	</head>
	<body>
		<!-- <div class="fenlei">
			我的
		</div> -->
		<div class="news">
			<div class="touxiang_box"><img src="img/jinrong.png" class="touxiang photo" id="pic" ></div>
			<input id="upload" name="file" accept="image/*" type="file" style="display: none">
			<p class="name"></p>
		</div>
		<div class="zhongxin">
			<p class="zhong_tit">个人中心：</p>
			<ul class="zhong_ul">
				<li class="xiaoxi">
					<img src="img/xiaoxi.png" alt="">
					<p>消息</p>
				</li>
				<li class="gongdu">
					<img src="img/gongdu.png" alt="">
					<p>共读</p>
				</li>
				<li class="shudan">
					<img src="img/Font_Linear.png" alt="">
					<p>感悟·书单</p>
				</li>
				<li class="shuping">
					<img src="img/mingpianyangshi.png" alt="">
					<p>书评</p>
				</li>
			</ul>
		</div>
		<ul class="wode">
			<li class="shouc">我的收藏</li>
			<li class="guanzhu">我的关注</li>
			<li class="my_ping">我的评论</li>
			<li class="yijian">意见反馈</li>
			<li class="guanyu">关于我们</li>
		</ul>
		<!--尾部 -->
		<footer class="footer">
			<nav>
				<a href="index.html">
					<img src="img/shouye_no.png" alt="" class="icon" />
					<p>阅览</p>
				</a>
				<a href="list.html">
					<img src="img/fenlei_no.png" alt="" class="icon" />
					<p>分类</p>
				</a>
				<a href="shujia.html">
					<img src="img/shujia_no.png" alt="" class="icon" />
					<p>书架</p>
				</a>
				<a href="wode.html" class="select-btn">
					<img src="img/wode_yes.png" alt="" class="icon" />
					<p>我的</p>
				</a>
			</nav>
		</footer>
		<div class="tan_box">
			<div class="tan"></div>
		</div>
	</body>
	<script>
		$('.shuping').click(function(){
			window.location.href="shuping.html?istype="+2
		})
		$('.xiaoxi').click(function(){
			window.location.href="xiaoxi.html"
		})
		$('.shudan').click(function(){
			window.location.href="shuping.html?istype="+1
		})
		$('.gongdu').click(function(){
			window.location.href="gongdu.html"
		})
		$('.shouc').click(function(){
			window.location.href="shouc.html"
		})
		$('.guanzhu').click(function(){
			window.location.href="guanzhu.html"
		})
		$('.my_ping').click(function(){
			window.location.href="ping_list.html"
		})
		$('.yijian').click(function(){
			window.location.href="yijian.html"
		})
		$('.guanyu').click(function(){
			window.location.href="guanyu.html"
		})
		var url=localStorage.url
		var company_identity = localStorage.company_identity
		var user_id = localStorage.user_id
		$.ajax(url + '/index.php/books/api/personal_api', {
			data: {
				user_id:user_id,
				company_identity: company_identity
			},
			type:'post',
			dataType: 'json', //服务器返回json格式数据
			success: function(data) {
				console.log(data)
				if(data.status==1){
					$('.name').html(data.data.user_name);
					$('.touxiang').attr('src',data.data.user_head_img)
				}else if(data.status==333){
							window.location.href="no_power.html"
						}
				
			},
			error: function(xhr, type, errorThrown) {
		
			}
		});
		$(function() {
		
			$("#pic").click(function() {
				$("#upload").click(); //隐藏了input:file样式后，点击头像就可以本地上传
				$("#upload").on("change", function() {
					objUrl = getObjectURL(this.files[0]); //获取图片的路径，该路径不是图片在本地的路径
					console.log(objUrl)
					$('.tan_box .tan').html('上传中');
					$('.tan').css('display', 'block');
					$('.save-btn').attr('disabled', 'disabled')
					if (objUrl) {
						$("#pic").attr("src", objUrl); //将图片路径存入src中，显示出图片
						upimg();
					}
				});
			});
		});
		//建立一?可存取到?file的url
		function getObjectURL(file) {
			var url = null;
			if (window.createObjectURL != undefined) { // basic
				url = window.createObjectURL(file);
			} else if (window.URL != undefined) { // mozilla(firefox)
				url = window.URL.createObjectURL(file);
			} else if (window.webkitURL != undefined) { // webkit or chrome
				url = window.webkitURL.createObjectURL(file);
			}
			return url;
		}
		//上传头像到服务器
		var imgurl = ''
		
		function upimg() {
			//       console.log(344)
			var pic = $('#upload')[0].files[0];
			var file = new FormData();
			file.append('img_data', pic);
			file.append('company_identity', company_identity);
			file.append('user_id', user_id);
			$.ajax({
				url: url + "/index.php/books/api/personal_upload_img",
				type: "post",
				data: file,
				cache: false,
				contentType: false,
				processData: false,
				dataType:'json',
				success: function(data) {
					console.log(data);
					$('.tan_box .tan').html('上传完毕');
					$('.tan').css('display', 'none');
					$('.save-btn').attr('disabled', false)
					imgurl = data.data
		
					//               $("#pic").append("<img src='+yuming+/" + res_data.data.img_url + "'>")
				}
			});
		}
	</script>
</html>
