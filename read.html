<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<meta content="telephone=no" name="format-detection" />
		<meta content="email=no" name="format-detection" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<script type="text/javascript" src="js/rem.js"></script>
		<script type="text/javascript" src="js/jquery-3.2.1.js"></script>
		<!-- <script type="text/javascript" src="js/pdfobject.js"></script> -->
		<script type="text/javascript" src="js/pdfobject.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/read.css" />
		<!-- <script src="build/pdf.js?v=20190218"></script>
		<script src="build/pdf.js?v=20190218"></script>
		<script src="web/viewer.js?v=20190218"></script> -->
		<!-- <link rel="stylesheet" href="web/viewer.css?v=20190218"> -->
		<title>
			阅读
		</title>
	</head>
	<body>
		<!-- <div class="fenlei">
			阅读
		</div> -->
		<div class="con_box">
			<div class="zhangjie"></div>
			<div class="read_con">
				<!-- <a target="_self" href="web/viewer.html?file=0002评传.pdf">查看文件.PDF</a> -->
				<!-- <iframe src="http://flydev.yuanchuangyuan.com/data/upload/books/book/pdf/2019-09-25/测试PDF/0002评传.pdf" width="100%" height="100%">该浏览器无法支持PDF，请点击查看：<a href="PDF地址">下载 PDF</a></iframe> -->
			</div>
			
		</div>
		<div style="height: 0.1rem;"></div>
		<div class="mulu_box">
			<div class="gong">共<span class="gongji"></span>章</div>
			<ul class="mulu">
			</ul>
		</div>
		<div class="shezhi_box">
			<div class="shezhi_con">
				<p>设置</p>
				<div class="shuqian shuqian_box">
					<span>书签名称：</span>
					<div>小</div>
					<div class="selected">中</div>
					<div>大</div>
				</div>
				<div class="shuqian moshi">
					<span>夜间模式：</span>
					<div>开启</div>
					<div class="selected">关闭</div>
				</div>
				<div class="anniu">
					<p class="qvxiao">取消</p>
					<p class="queren">确认</p>
				</div>
			</div>
		</div>
		<div class="tian_shuqian">
			<div class="tian_dong">
				<p>添加书签</p>
				<div class="shuqian_name">
					<span>书签名称：</span>
					<input type="text" placeholder="请输入书签名称" class="qian_input">
				</div>
				<div class="tian_anniu">
					<p class="qvxiao">取消</p>
					<p class="tian_queren">确认</p>
				</div>
			</div>
		</div>
		<ul class="bott">
			<li class="mulu_btn">目录</li>
			<li class="write_shu">写书评</li>
			<li class="add_shu">添加书签</li>
			<li class="shezhi">设置</li>
		</ul>
		<div class="tan"></div>
	</body>

	<script>
		if(PDFObject.supportsPDFs){
			console.log(111)
		        // PDF嵌入到网页
				var a="http://flydev.yuanchuangyuan.com/data/upload/books/book/pdf/2019-09-25/测试PDF/0002评传.pdf"
		        PDFObject.embed(a, ".read_con" );
		    } else {
		        console.log(222)
				// location.href = "read.html";
		    }
		// window.onload = function() {
		// var success = new PDFObject({
		// 	url: "http://flydev.yuanchuangyuan.com/data/upload/books/book/pdf/2019-09-25/测试PDF/0002评传.pdf"
		// }).embed('.read_con');
		// PDFObject.embed("http://flydev.yuanchuangyuan.com/data/upload/books/book/pdf/2019-09-25/测试PDF/0002评传.pdf", ".read_con");
		// };
		var url = localStorage.url
		var books_id = ''
		var zhangjie = ''
		function geturl() {
			var url_parameter = window.location.search.substr(1);
			var parameter_arr = url_parameter.split("&");
			var parameter_arr_new = [];
			if (parameter_arr) {
				for (var i = 0; i < parameter_arr.length; i++) {
					parameter_arr_new.push(parameter_arr[i].substring(parameter_arr[i].indexOf('=') + 1));
				}
				books_id = parameter_arr_new[0];
				zhangjie= parameter_arr_new[1];
			}
		}
		geturl();
		// 第几章  会改变

		function read() {
			$.ajax(url + '/index.php/books/api/get_books_catalog_details_api', {
				data: {
					books_id: books_id,
					user_id: 1,
					catalog_id: zhangjie
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				success: function(data) {
					console.log(data)
					$('.zhangjie').html(data.data.now_catalog.catalog_name)
					$('.read_con').html(data.data.now_catalog.content)
					// if (data.data.now_catalog.content == null) {
					// 	$('.read_con').html('<iframe src="' + data.data.now_catalog.file_url +
					// 		'" width="100%" height="100%">该浏览器无法支持PDF，请点击查看：<a href="PDF地址">下载 PDF</a></iframe>')

					// }
					$('.gongji').html(data.data.catalog_list.length)
					var pick = data.data.catalog_list
					var picker = '';
					$.each(pick, function(i, obj) {
						picker += '<li onclick="zhang(' + obj.catalog_id + ',' + i + ')">'
						picker += obj.catalog_name
						picker += '</li>';
					})
					$('.mulu').html(picker)
					$(window).scrollTop(0);
				}
			});
		}
		read();

		var that = this;
		// $(window).scroll(function() {
		// 	//当时滚动条离底部60px时开始加载下一页的内容
		// 	if (($(window).height() + $(window).scrollTop() + 60) >= $(document).height()) {
		// 		//加载更多操作
		// 		zhangjie += 1;
		// 		console.log(zhangjie)
		// 		read();
		// 	}
		// });

		// 点击目录列表
		var lie_num=''
		function zhang(num, id) {
			console.log(num)
			console.log(id)
			$('.mulu_box').css('display','none')
			$('.bott li').css('color', '#666666')
			zhangjie = num
			read();
			lie_num=id
		}
		var size = localStorage.size
		if (size) {
			$('.con_box').css('fontSize', size)
		}
		var back = localStorage.back
		if (back) {
			$('.con_box').css('background', back)
		}
		var color = localStorage.color
		if (color) {
			$('.con_box').css('color', color)
		}
		// 点击设置
		$('.shezhi').click(function() {
			$('.shezhi_box').show()
			$(this).css('color', '#D7142A')
		})
		// 字体大小
		var shuqian = '中'
		$('.shuqian_box>div').click(function() {
			$('.shuqian_box>div').removeClass('selected')
			$(this).addClass('selected')
			shuqian = $(this).html()
		})
		// 开关模式
		var moshi = '关闭'
		$('.moshi>div').click(function() {
			$('.moshi>div').removeClass('selected')
			$(this).addClass('selected')
			moshi = $(this).html()
		})
		// 确认
		$('.queren').click(function() {
			if (shuqian == '小') {
				$('.con_box').css({
					fontSize: '0.2rem'
				})
				localStorage.setItem('size', '0.2rem');
			} else if (shuqian == '中') {
				$('.con_box').css({
					fontSize: '0.28rem'
				})
				localStorage.setItem('size', '0.28rem');
			} else if (shuqian == '大') {
				$('.con_box').css({
					fontSize: '0.34rem'
				})
				localStorage.setItem('size', '0.34rem');
			}
			if (moshi == '关闭') {
				$('.con_box').css({
					'background': 'rgba(255,255,255,1)',
					'color':'#666666'
				})
				localStorage.setItem('back', 'rgba(255,255,255,1)');
				localStorage.setItem('color', '#666666');
			} else if (moshi == '开启') {
				$('.con_box').css({
					'background':'rgba(30,30,30,0.5)',
					'color':'#ffffff'
				})
				localStorage.setItem('back', 'rgba(30,30,30,0.5)');
				localStorage.setItem('color', '#ffffff');
			}
			$('.shezhi_box').hide()
			$('.bott li').css('color', '#666666')
		})
		// 点击取消
		$('.qvxiao').click(function() {
			$('.shezhi_box').hide()
			$('.bott li').css('color', '#666666')
			$('.tian_shuqian').hide()
		})
		var a=0;
		// 目录
		$('.mulu_btn').click(function() {
			console.log(a)
			a+=1;
			if(a%2==0){
				$('.mulu_box').hide()
				$(this).css('color', '#666666')
				$(".mulu").find("li").eq(lie_num).css('color','red')
			}else{
				$('.mulu_box').show()
				$(this).css('color', '#D7142A')
				$(".mulu").find("li").eq(lie_num).css('color','red')
			}
			
		})

		// 添加书签
		$('.add_shu').click(function() {
			$('.tian_shuqian').show()
			$(this).css('color', '#D7142A')
		})
		// 写书评
		$('.write_shu').click(function() {
			window.location.href = "xieshuping.html"
		})
		// 添加书签
		$('.tian_queren').click(function(){
			var shuqian_con=$('.qian_input').val();
			console.log(shuqian_con)
			$.ajax(url + '/index.php/books/api/add_book_mark_api', {
				data: {
					books_id: books_id,
					user_id: 1,
					catalog_id: zhangjie,
					mark_name:shuqian_con
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				success: function(data) {
					console.log(data)
					if(data.status==1){
						$('.tian_shuqian').hide();
						$('.bott li').css('color', '#666666')
						// 提示框显示隐藏
						$('.tan').html('添加成功');
						$('.tan').css('display', 'block');
						$('.tan').fadeOut(2000);
					}
				}
			});
		})
	</script>
</html>
